name: Jenkins to GitHub Actions Migration

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Allows manual trigger (like "Build Now")

jobs:
  build:
    runs-on: windows-latest  # Windows runner (like your Jenkins)
    
    steps:
      # Step 1: Checkout code (like Jenkins checkout stage)
      - name: üöÄ Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Get all history for git log

      # Step 2: Hello Stage (like Jenkins Hello)
      - name: üëã Hello from GitHub Actions!
        run: |
          echo "üéâ Hello from GitHub Actions!"
          echo "Build Number: ${{ github.run_number }}"
          echo "Job Name: ${{ github.job }}"
          echo "Workspace: ${{ github.workspace }}"

      # Step 3: System Info (like Jenkins System Info)
      - name: üíª System Information
        run: |
          echo "==== WINDOWS SYSTEM INFO ===="
          ver
          echo "User: $env:USERNAME"
          echo "Computer: $env:COMPUTERNAME"
          echo "Processor Count: $env:NUMBER_OF_PROCESSORS"
          echo "Architecture: $env:PROCESSOR_ARCHITECTURE"
          
          # PowerShell for detailed system info
          powershell -Command "Get-CimInstance Win32_OperatingSystem | Select-Object Caption, Version | Format-List"

      # Step 4: Workspace Check (like Jenkins Workspace Check)
      - name: üìÅ Workspace Contents
        run: |
          echo "==== WORKSPACE CONTENTS ===="
          dir /B
          echo "Workspace path: ${{ github.workspace }}"
          dir

      # Step 5: Git Test (like Jenkins Git Test)
      - name: üîß Git Information
        run: |
          echo "==== GIT INFORMATION ===="
          git --version
          git log --oneline -3
          git remote -v

      # Step 6: Run Tests (like Jenkins Run Tests)
      - name: üß™ Run Automated Tests
        run: call test.bat

      # Step 7: Success (like Jenkins Success)
      - name: ‚úÖ Success
        run: |
          echo "‚úÖ All stages completed successfully!"
          echo "üöÄ GitHub Actions is working perfectly!"
          echo "Time: $(Get-Date -Format 'HH:mm:ss')"

      # Step 8: Email Notification (like Jenkins Email)
      - name: üìß Send Email Notification
        if: success()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.GMAIL_USERNAME }}
          password: ${{ secrets.GMAIL_APP_PASSWORD }}
          subject: "‚úÖ GitHub Actions Build #${{ github.run_number }} Success"
          to: muhammedjohn3@gmail.com
          from: GitHub Actions
          body: |
            <h3>‚úÖ GitHub Actions Build Success!</h3>
            <p><b>Repository:</b> ${{ github.repository }}</p>
            <p><b>Build #:</b> ${{ github.run_number }}</p>
            <p><b>Status:</b> SUCCESS</p>
            <p><b>Commit:</b> ${{ github.sha }}</p>
            <p><b>View Workflow:</b> <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}">Link</a></p>
            <p><b>Triggered by:</b> ${{ github.actor }}</p>
            <hr>
            <p>This email was sent automatically by GitHub Actions.</p>
          html: true

  # Bonus: Add a deployment job (parallel execution example)
  deploy:
    runs-on: ubuntu-latest
    needs: build  # Only run if build succeeds
    if: success()
    
    steps:
      - name: üöÄ Simulate Deployment
        run: |
          echo "Simulating deployment to staging..."
          sleep 5
          echo "‚úÖ Deployment simulation complete!"
          
      - name: üìä Generate Report
        run: |
          echo "# Build Report" > report.md
          echo "## Repository: ${{ github.repository }}" >> report.md
          echo "## Build: ${{ github.run_number }}" >> report.md
          echo "## Status: SUCCESS" >> report.md
          echo "## Date: $(date)" >> report.md
          
      - name: üì§ Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          name: build-report
          path: report.md
